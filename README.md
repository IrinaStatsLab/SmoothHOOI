
<!-- README.md is generated from README.Rmd. Please edit that file -->

# SmoothHOOI

<!-- badges: start -->

<!-- badges: end -->

SmoothHOOI is an R package that implements methods described in ‘’Smooth
Tensor Decomposition with Application to Ambulatory Blood Pressure
Monitoring Data’’

## Installation

You can install the development version of SmoothHOOI from
[GitHub](https://github.com/) with:

``` r
# install.packages("devtools")
devtools::install_github("IrinaStatsLab/SmoothHOOI")
```

## Example

This is a simple example which shows you how to use this package on a
synthetic dataset.

``` r
library(SmoothHOOI)

# generate a 24*3*207 three-way tensor to mimic ABPM data
data("synthetic_raw") # load L, G, R, and residuals generated from the real HYPNOS ABPM data

synthetic <- synthetic_data(synthetic_raw$L_tilde, synthetic_raw$R_tilde, synthetic_raw$mean_G, synthetic_raw$cov_G, synthetic_raw$E, p=207, noise_level=1, pattern="random", percent=0.2)

ground_truth <- synthetic$sim_Msmooth # ground truth smooth data
synthetic_dat <- synthetic$sim_Mmiss # noisy, incomplete data
```

``` r
# Make the second order difference matrix 
D2 <- SecDiffMat(24)
```

``` r
# Find optimal hyperparameter with 5-fold cross-validation
set.seed(32123)

kcv_res <- kcv(tnsr=synthetic_dat@data, rank_grid=as.matrix(expand.grid(r1<-seq(3,6,by=1), r2<-c(2,3))), lambda_seq=seq(1,20,by=1), k=5, L0=NULL, D=D2, tol=0.01, max_iter=500, init=0)

kcv_res$MSE_mat # matrix for CV error (rows representing ranks, cols representing lambda)
#>           [,1]      [,2]      [,3]      [,4]      [,5]      [,6]      [,7]
#> [1,] 0.4614091 0.4607263 0.4604122 0.4602795 0.4602281 0.4602350 0.4602623
#> [2,] 0.4840599 0.4781512 0.4741233 0.4712030 0.4689998 0.4673011 0.4659559
#> [3,] 0.5030408 0.4935075 0.4871005 0.4824432 0.4789265 0.4761849 0.4740076
#> [4,] 0.5090148 0.4945709 0.4862982 0.4807665 0.4767806 0.4737794 0.4714481
#> [5,] 0.4954762 0.4940214 0.4931946 0.4926327 0.4921958 0.4918735 0.4915959
#> [6,] 0.5451093 0.5344900 0.5268112 0.5200737 0.5169161 0.5135130 0.5107639
#> [7,] 0.5755178 0.5564961 0.5439995 0.5351272 0.5284824 0.5233402 0.5192436
#> [8,] 0.5842061 0.5553810 0.5400606 0.5301402 0.5231703 0.5179329 0.5138927
#>           [,8]      [,9]     [,10]     [,11]     [,12]     [,13]     [,14]
#> [1,] 0.4603146 0.4603769 0.4604462 0.4605209 0.4606004 0.4606653 0.4607553
#> [2,] 0.4648833 0.4640011 0.4632830 0.4626866 0.4621944 0.4617849 0.4614470
#> [3,] 0.4722544 0.4708063 0.4696068 0.4686078 0.4677586 0.4670398 0.4664343
#> [4,] 0.4696017 0.4681038 0.4668696 0.4658501 0.4649983 0.4642897 0.4637004
#> [5,] 0.4913340 0.4910966 0.4908817 0.4906561 0.4904563 0.4902788 0.4901132
#> [6,] 0.5084853 0.5065646 0.5049218 0.5035176 0.5022785 0.5012070 0.5002615
#> [7,] 0.5158984 0.5131520 0.5108151 0.5088430 0.5071487 0.5056506 0.5043690
#> [8,] 0.5106899 0.5080690 0.5058853 0.5040617 0.5025083 0.5011790 0.5000379
#>          [,15]     [,16]     [,17]     [,18]     [,19]     [,20]
#> [1,] 0.4608508 0.4609543 0.4610566 0.4611713 0.4612930 0.4614218
#> [2,] 0.4611745 0.4609483 0.4607719 0.4606295 0.4605253 0.4604580
#> [3,] 0.4659182 0.4654775 0.4651005 0.4647877 0.4645245 0.4643002
#> [4,] 0.4631970 0.4627673 0.4624176 0.4621332 0.4618874 0.4616862
#> [5,] 0.4899504 0.4898096 0.4896808 0.4895680 0.4894589 0.4893659
#> [6,] 0.4994053 0.4986606 0.4979964 0.4974037 0.4968736 0.4963812
#> [7,] 0.5032253 0.5022087 0.5013252 0.5005300 0.4998247 0.4991799
#> [8,] 0.4990378 0.4981672 0.4974113 0.4967444 0.4961614 0.4956468
kcv_res$opt_para # optimal hyperparameters
#>      [,1] [,2] [,3]
#> [1,]    3    2    5
```

``` r
# Run SmoothHOOI algorithm with the optimal hyperparameters
res <- mglram(tnsr = synthetic_dat@data, ranks = c(3, 2), init=0, D = D2,
       lambda = 5, max_iter = 500, tol = 1e-5, L0 = NULL)

res$conv # check convergence
#> [1] TRUE
```

``` r
# Rotation for Identifiability
tilde <- MakeIdent(L=res$L, G=res$G, R=res$R)

tilde$L_tilde
#>             [,1]         [,2]        [,3]
#>  [1,] -0.2205802  0.188561968 -0.12290209
#>  [2,] -0.2169324  0.213898436 -0.05212827
#>  [3,] -0.2142264  0.229819298  0.01373446
#>  [4,] -0.2125216  0.236111742  0.06991613
#>  [5,] -0.2119296  0.233191711  0.11735893
#>  [6,] -0.2118249  0.218724765  0.15578971
#>  [7,] -0.2110177  0.189525634  0.18857814
#>  [8,] -0.2059345  0.144267264  0.21917604
#>  [9,] -0.1975030  0.082466615  0.24486194
#> [10,] -0.1876203  0.005367513  0.26474911
#> [11,] -0.1785877 -0.081012889  0.27321662
#> [12,] -0.1732977 -0.167819190  0.26394834
#> [13,] -0.1721589 -0.243589244  0.23355334
#> [14,] -0.1735476 -0.299639244  0.18086605
#> [15,] -0.1778476 -0.331208794  0.10747464
#> [16,] -0.1847179 -0.333632190  0.01974864
#> [17,] -0.1934212 -0.306676330 -0.07634626
#> [18,] -0.2026906 -0.254280627 -0.17020345
#> [19,] -0.2118067 -0.183977330 -0.24906742
#> [20,] -0.2190443 -0.104959012 -0.29949145
#> [21,] -0.2243650 -0.027054164 -0.31670886
#> [22,] -0.2271743  0.042453418 -0.30138400
#> [23,] -0.2266186  0.102289752 -0.25791588
#> [24,] -0.2241003  0.151389487 -0.19418115
tilde$R_tilde
#>            [,1]       [,2]
#> [1,] -0.6116550  0.2772670
#> [2,] -0.5128883  0.5741153
#> [3,] -0.6023485 -0.7703990
tilde$G_tilde[ , ,1]
#>            [,1]      [,2]
#> [1,]  8.4980879  8.714276
#> [2,] -2.9291665  1.025470
#> [3,] -0.4745675 -0.555340
```
